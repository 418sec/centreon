######################################################
# How to upgrade your 1.3.3 in 1.4.1-RC1 ?
######################################################


- Download centreon-1.4.1-RC1.tar.gz

- unzip centreon-1.4.1.-RC1.tar.gz :

$> tar -xzf centreon-1.4.1.-RC1.tar.gz

- launch upgrade script :

$> cd /root/centreon-1.4.1.-RC1
$>./install.sh

- Answer to all questions to upgrade your release.

- Log to mysql, create 'ods' database and create tables :  

consider : 
	ods = table for oreon data storage
	root = login mysql for root
	mysql-password = mysql password
	oreon = oreon user mysql

$>mysql -u root -p
mysql> CREATE DATABASE `ods` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
mysql> GRANT ALL PRIVILEGES ON `ods` . * TO 'oreon'@'localhost';
mysql> exit 
$> cat /root/centreon-1.4.1-RC1/www/install/createTablesODS.sql | mysql -u root -p ods

After all this request, add in oreon.conf.php file in installed oreon/www/ directory of centreon this line :

$conf_oreon['ods'] = "ods";

juste after 

$conf_oreon['db'] = "oreon";

Now we are gonna made the SQL upgrades, there are two upgrade to make, but with the upgrade web process, we can't go back to apply another patch. There'll be a very simple hand manipulation to make.
So, first of all, you have to delete your old Oreon 1.3.3 install folder, which is located in /oreon/www/ with a 6 letters name such as 'hgaert' or '4rf6b3', just delete it, it is obsolete.

$> rm -rf oreon/www/wg45fa

Then, go on you Centreon web interface to apply SQL update.

http://youroreonip/oreon/

Apply patch 'UpdateDB-1.4.sql', and push 'next' until you can log on Centreon page.

Now, you have to rename the install folder, in order to apply again another patch. So rename the 6 letters folders just created by the previous step name such as 'hgaert' or '4rf6b3' to 'install'.

$> mv oreon/www/rghuqd oreon/www/install

Then, go on you Centreon web interface to apply SQL update.

http://youroreonip/oreon/

Apply patch 'UpdateDB-1.4.1-RC1.sql', and push 'next' until you can log on Centreon page.

Everything fine ? Great !

Check if everything is ok  (Path, macros like @NAGIOS_PATH_DIR@ are correctly replace, execution..):
General Options -> Centreon
General Options -> Centreon Data Storage
General Options -> SNMP
Configuration -> Nagios -> Nagios.cfg
Configuration -> Nagios -> Resource.cfg

!!CAUTION!!
In this new release, we don't manage anymore graphs plugins storage, so your check_graph_* plugins will not work anymore (Problem with -S arg will occur)
Please modify the commands using this plugins by using now check_centreon_* plugins.
For example : 
command "check_graph_ping" => "$USER1$/check_graph_ping.pl ... -g -S $ARGn$ " 
can became "check_graph_ping" => "$USER1$/check_centreon_ping ..." 
or "check_centreon_ping" => "$USER1$/check_centreon_ping ..."

Then generate/restart Nagios and start ods
$> /etc/init.d/ods start
