(function(e){jQuery.fn.sheepIt=function(t){function n(){var e;if(typeof t.beforeClone==="function"){t.beforeClone(st,dt)}e=dt.cloneWithAttribut(true);if(typeof t.afterClone==="function"){t.afterClone(st,e)}e.getSource=function(){return st};return e}function r(e){e.preventDefault();g()}function i(e){e.preventDefault();if(at.value!==""){y(at.attr("value"))}}function s(n){n.preventDefault();if(typeof t.beforeRemoveCurrent==="function"){t.beforeRemoveCurrent(st)}if(t.removeCurrentConfirmation){if(confirm(t.removeCurrentConfirmationMsg)){E(e(this).data("removableClone"))}}else{E(e(this).data("removableClone"))}if(typeof t.afterRemoveCurrent==="function"){t.afterRemoveCurrent(st)}}function o(e){e.preventDefault();if(t.removeLastConfirmation){if(confirm(t.removeLastConfirmationMsg)){b()}}else{b()}}function u(e){e.preventDefault();if(t.removeAllConfirmation){if(confirm(t.removeAllConfirmationMsg)){w()}}else{w()}}function a(e,t){var n=e.attr(t);e.attr(t+"template",escape(n));return n}function f(n,r){n.find(gt).each(function(){var i=e(this),s=a(i,"id"),o=a(i,"name"),u=i.attr("id"),f=i.attr("name");if(typeof newNameAttr=="string"){newNameAttr=o.replace(t.indexFormat,r);i.attr("name",newNameAttr)}if(typeof newIdAttr=="string"){newIdAttr=s.replace(t.indexFormat,r);n.find("label[for='"+u+"']").each(function(){e(this).attr("for",newIdAttr)});i.attr("id",newIdAttr)}})}function l(e,t){c(e,t+1)}function c(e,n){e.find(t.labelSelector).html(n);return true}function h(e){return e.find(t.labelSelector).html()}function p(){if(R()){if(D()==1){ht.hideIf();lt.showIf()}else{ht.showIf();lt.showIf()}var e="";if(t.allowRemoveCurrent){e=st.find(t.removeCurrentSelector);if(z()){e.show()}else{e.hide()}}else{e=st.find(t.removeCurrentSelector);e.hide()}}else{lt.hideIf();ht.hideIf()}if(!U()){ot.hideIf();ut.hideIf()}else{ot.showIf();ut.showIf()}if(!z()){lt.hideIf();ht.hideIf()}if(ot.css("display")!="none"||ut.css("display")!="none"||ht.css("display")!="none"||lt.css("display")!="none"){pt.show()}else{pt.hide()}}function d(){if(R()){mt.hide();if(t.continuousIndex){var e=0,n=P();do{v(n,e);e++;n=B(n)}while(n!=false)}}else{mt.show()}}function v(e,n){if(typeof n=="undefined"){n=_()}var r=a(e,"id");if(e.attr("id")){e.attr("id",r+n)}f(e,n);l(e,n);if(e.html().indexOf(t.indexFormat)!=-1){var i=new RegExp(t.indexFormat,"ig");e.html(e.html().replace(i,n))}var s=e.find(t.removeCurrentSelector);t.allowRemoveCurrent?s.show():s.hide();return e}function m(){d();p()}function g(r,i){if(typeof r=="undefined"){r=true}if(typeof i=="undefined"){i=false}if(typeof t.beforeAdd==="function"){t.beforeAdd(st)}var o=false;if(i){if(typeof i=="string"){o=e("#"+i)}else if(typeof i=="object"){o=i}else{return false}o.remove()}else{o=n()}if(U()&&o){o=v(o);var u=o.find(t.removeCurrentSelector).first();u.click(s);u.data("removableClone",o);o.data("formIndex",_());o.data("previousSeparator",false);o.data("nextSeparator",false);o.data("previousForm",false);o.data("nextForm",false);if(R()){var a=H();a.data("nextForm",o);o.data("previousForm",a);if(t.separator){var f=G();f.insertAfter(a);a.data("nextSeparator",f);o.data("previousSeparator",f)}}t.insertNewForms=="after"?o.insertBefore(mt):o.insertAfter(mt);if(t.nestedForms.length>0){var l=0;var c=[];for(l in t.nestedForms){if(typeof t.nestedForms[l].id!="undefined"&&typeof t.nestedForms[l].options!="undefined"){t.nestedForms[l].isNestedForm=true;t.nestedForms[l].parentForm=st;var h=t.nestedForms[l].id.replace(t.indexFormat,o.data("formIndex"));var p=e("#"+h).sheepIt(t.nestedForms[l].options);c.push(p)}}o.data("nestedForms",c)}rt(o);yt.push(o);if(r||t.continuousIndex){m()}if(typeof t.afterAdd==="function"){t.afterAdd(st,o)}return true}else{return false}}function y(e,t){if(typeof e!="undefined"){e=parseFloat(e);var n=1;for(n=1;n<=e;n++){g(t)}}}function b(e){if(typeof e=="undefined"){e=true}if(z()){S();if(e){m()}return true}else{return false}}function w(e){if(typeof e=="undefined"){e=true}if(W()){var t=[];for(t in yt){if(yt[t]){S(yt[t])}}if(e){m()}return true}else{return false}}function E(e,t){if(typeof t=="undefined"){t=true}if(z()){S(e);if(t){m()}return true}else{return false}}function S(e){if(typeof e=="undefined"){e=H()}index=e.data("formIndex");if(e.data("previousSeparator")&&e.data("nextSeparator")){e.data("previousSeparator").remove();e.data("previousForm").data("nextSeparator",e.data("nextSeparator"))}else if(e.data("previousSeparator")&&!e.data("nextSeparator")){e.data("previousSeparator").remove();e.data("previousForm").data("nextSeparator",false)}else if(!e.data("previousSeparator")&&e.data("nextSeparator")){e.data("nextSeparator").remove();e.data("nextForm").data("previousSeparator",false)}if(e.data("previousForm")){e.data("previousForm").data("nextForm",e.data("nextForm"))}if(e.data("nextForm")){e.data("nextForm").data("previousForm",e.data("previousForm"))}yt[index]=false;e.remove();return true}function x(){return bt}function T(){if(bt!==false){if(yt.length>1){var e=0;var t=parseFloat(bt+1);for(e=t;e<yt.length;e++){if(yt[e]){bt=e;return true}}return false}else{return false}}else{return false}}function N(){if(bt!==false){if(yt.length>1){var e=0;var t=parseFloat(bt-1);for(e=t;e>=0;e--){if(yt[e]){bt=e;return true}}return false}else{return false}}else{return false}}function C(){bt=false;if(yt.length>0){var e=0;for(;e<yt.length;e++){if(yt[e]){bt=e;return true}}return false}else{return false}}function k(){bt=false;if(yt.length>0){if(yt[yt.length-1]){bt=yt.length-1;return true}else{var e=0;for(e=yt.length-1;e>=0;e--){if(yt[e]){bt=e;return true}}return false}}else{return false}}function L(){if(yt.length>0){return yt.length}else{return 0}}function A(e){if(typeof e!="undefined"){bt=O(e);if(bt!==false){return true}else{return false}}else{return false}}function O(e){var t=0;var n=0;var r=false;for(t=0;t<yt.length;t++){if(yt[t]){n++;if(e==n){r=t}}}return r}function M(e){var t=0;var n=0;for(t=0;t<=e;t++){if(yt[t]){n++}}return n}function _(){return yt.length}function D(){return L()}function P(){if(C()!==false){return F()}else{return false}}function H(){if(k()!==false){return F()}else{return false}}function B(e){if(e){return e.data("nextForm")}else if(x()!==false){if(T()!==false){return F()}else{return false}}else{return false}}function j(e){if(e){return e.data("previousForm")}else if(x()!==false){if(N()!==false){return F()}else{return false}}else{return false}}function F(){if(x()!==false){return yt[x()]}else{return false}}function I(e){if(R()){if(typeof e!="undefined"){A(e);return F()}else{return H()}}else{return false}}function q(){if(R()){C();var e=0;var t=[];for(e=0;e<D();e++){t.push(F());T()}return t}else{return false}}function R(){return D()>0?true:false}function U(){if(t.maxFormsCount==0){return true}else{return D()<t.maxFormsCount?true:false}}function z(){return D()>t.minFormsCount?true:false}function W(){return t.minFormsCount==0?true:false}function X(t){if(e("#"+t.attr("id")).length>0){return true}else{return false}}function V(n,r){var i="";if(typeof n=="number"){n++;if(n>D()){g()}i=I(n);J(i,r)}else if(typeof n=="string"){i=e("#"+n);J(i,r)}if(typeof t.afterFill==="function"){t.afterFill(st,i,r)}}function J(n,r){var i=0;e.each(r,function(e,r){var s=st.attr("id");var o=n.data("formIndex");var u="#index#";if(typeof t.indexFormat!="undefined"&&t.indexFormat){u=t.indexFormat}if(e.indexOf("#form#")!=-1||e.indexOf(u)!=-1){e=e.replace("#form#",s);e=e.replace(u,o)}else{e=s+"_"+o+"_"+e}var a=n.find(':input[id="'+e+'"]');if(a.length==0){a=n.find(':input[name="'+e+'"]');if(a.length==0){a=n.find(':input[name="'+e+'[]"]')}}if(a.length>0){var f=false;if(typeof r=="object"){f=true}var l=false;if(a.length>1){l=true}if(l){if(f){var c=[];c["fields"]=[];c["values"]=[];i=0;for(i in r){c["fields"].push(a.filter('[value="'+r[i]+'"]'));c["values"].push(r[i])}i=0;for(i in c["fields"]){K(c["fields"][i],c["values"][i])}}else{K(a.filter('[value="'+r+'"]',r))}}else{if(f){i=0;for(i in r){K(a,r[i])}}else{K(a,r)}}}else{if(typeof n.data("nestedForms")!="undefined"){if(n.data("nestedForms").length>0){i=0;for(i in n.data("nestedForms")){if(e==n.data("nestedForms")[i].attr("id")&&typeof r=="object"){n.data("nestedForms")[i].inject(r)}}}}}})}function K(t,n){var r=t.attr("type");if(r=="text"||r=="hidden"||r=="password"){t.attr("value",n);return true}else if(r=="textarea"){t.text(n);return true}else if(r=="checkbox"||r=="radio"){t.attr("checked","checked");return true}else if(r=="select-one"||r=="select-multiple"){t.find("option").each(function(){if(e(this).text()==n||e(this).attr("value")==n){e(this).attr("selected","selected")}});return true}else{return false}}function Q(){if(t.separator!=""){return true}else{return false}}function G(){if(Q()){return e(t.separator)}else{return false}}function Y(n){t=[];t=e.extend(wt,n);it(t)}function Z(){return t}function et(){st.hide();ot=e(t.addSelector);ut=e(t.addNSelector);at=e(t.addNInputSelector);ft=e(t.addNButtonSelector);lt=e(t.removeLastSelector);ct=e(t.removeCurrentSelector);ht=e(t.removeAllSelector);pt=e(t.controlsSelector);if(ot.length==0){t.allowAdd=false}if(ut.length==0){t.allowAddN=false}if(lt.length==0){t.allowRemoveLast=false}if(ht.length==0){t.allowRemoveAll=false}tt(ot,t.allowAdd,r);tt(ut,t.allowAddN,i,ft);tt(lt,t.allowRemoveLast,o);tt(ht,t.allowRemoveAll,u);ot.init();ut.init();lt.init();ht.init();vt=e(t.formTemplateSelector);mt=e(t.noFormsTemplateSelector);dt=vt.cloneWithAttribut(true);vt.remove();var n=0;if(t.pregeneratedForms.length>0){n=0;for(n in t.pregeneratedForms){g(false,t.pregeneratedForms[n])}}if(t.iniFormsCount>D()){n=0;var s=t.iniFormsCount-D();for(n=1;n<=s;n++){g(false)}}if(t.data){st.inject(t.data)}m();st.show()}function tt(t,n,r,i){if(typeof i=="undefined"){i=false}e.extend(t,{hideIf:function(e,r){if(n){t.hide(e,r)}},showIf:function(e,r){if(n){t.show(e,r)}},init:function(){if(n){if(i){i.click(r)}else{t.click(r)}t.show()}else{t.hide()}}})}function nt(n){e.extend(n,{getAddControl:function(){return ot},getAddNControl:function(){return ut},getRemoveLastControl:function(){return lt},getRemoveAllControl:function(){return ht},getOptions:function(){return Z()},getOption:function(e){return t[e]},setOption:function(e,n){if(typeof e!="undefined"&&typeof n!="undefined"){t[e]=n;return t[e]}else{return false}},getForms:function(){return q()},getAllForms:function(){return q()},getForm:function(e){if(typeof e!="undefined"){e++}return I(e)},getLastForm:function(){return I()},getFirstForm:function(){C();return F()},addForm:function(){return g()},addNForms:function(e){return y(e)},getFormsCount:function(){return D()},hasForms:function(){return R()},canAddForm:function(){return U()},canRemoveAllForms:function(){return W()},canRemoveForm:function(){return z()},removeAllForms:function(){return w()},removeLastForm:function(){return b()},removeFirstForm:function(){C();return S(F())},removeForm:function(e){if(typeof e!="undefined"){e++}return S(I(e))},inject:function(t){e.each(t,e.proxy(V,n))}})}function rt(t){e.extend(t,{setLabel:function(e){return c(t,e)},getLabel:function(){return h(t)},inject:function(e){J(t,e)},getNestedForms:function(){return t.data("nestedForms")},getNestedForm:function(e){return t.data("nestedForms")[e]},getPosition:function(){return M(t.data("formIndex"))},getPreviousForm:function(){return j(t)},getNextForm:function(){return B(t)},removeForm:function(){return S(t)}})}function it(e){if(e.maxFormsCount>0){if(e.maxFormsCount<e.minFormsCount){e.maxFormsCount=e.minFormsCount}if(e.iniFormsCount<e.minFormsCount||e.iniFormsCount>e.maxFormsCount){e.iniFormsCount=e.minFormsCount}}else{if(e.iniFormsCount<e.minFormsCount){e.iniFormsCount=e.minFormsCount}}if(!W()){e.allowRemoveAll=false}}var st=e(this).first();nt(st);var ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt="input, checkbox, select, textarea",yt=[],bt=false,wt={addSelector:"#"+e(this).attr("id")+"_add",addNSelector:"#"+e(this).attr("id")+"_add_n",addNInputSelector:"#"+e(this).attr("id")+"_add_n_input",addNButtonSelector:"#"+e(this).attr("id")+"_add_n_button",removeLastSelector:"#"+e(this).attr("id")+"_remove_last",removeCurrentSelector:"#"+e(this).attr("id")+"_remove_current",removeAllSelector:"#"+e(this).attr("id")+"_remove_all",controlsSelector:"#"+e(this).attr("id")+"_controls",labelSelector:"#"+e(this).attr("id")+"_label",allowRemoveLast:true,allowRemoveCurrent:true,allowRemoveAll:false,allowAdd:true,allowAddN:false,removeLastConfirmation:false,removeCurrentConfirmation:false,removeAllConfirmation:true,removeLastConfirmationMsg:"Are you sure?",removeCurrentConfirmationMsg:"Are you sure?",removeAllConfirmationMsg:"Are you sure?",formTemplateSelector:"#"+e(this).attr("id")+"_template",noFormsTemplateSelector:"#"+e(this).attr("id")+"_noforms_template",separator:'<div style="width:100%; border-top:1px solid #ff0000; margin: 10px 0px;"></div>',iniFormsCount:1,maxFormsCount:20,minFormsCount:1,incrementCount:1,noFormsMsg:"No forms to display",indexFormat:"#index#",data:[],pregeneratedForms:[],nestedForms:[],isNestedForm:false,parentForm:{},beforeClone:function(){},afterClone:function(){},beforeAdd:function(){},afterAdd:function(){},afterFill:function(){},afterRemoveCurrent:function(){},beforeRemoveCurrent:function(){},insertNewForms:"after",continuousIndex:true};Y(t);et();return st};jQuery.fn.cloneWithAttribut=function(t){if(jQuery.support.noCloneEvent){return e(this).clone(t)}else{e(this).find("*").each(function(){e(this).data("name",e(this).attr("name"))});var n=e(this).clone(t);n.find("*").each(function(){e(this).attr("name",e(this).data("name"))});return n}}})(jQuery)
